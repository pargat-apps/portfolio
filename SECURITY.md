# üîí Security Implementation

This portfolio implements a comprehensive Content Security Policy (CSP) with different configurations for development and production environments.

## CSP Configuration

### üõ†Ô∏è Development Mode
- **Location**: `index.html` (active during `npm run dev`)
- **Script Policy**: `script-src 'self' 'unsafe-inline' 'unsafe-eval'`
- **Purpose**: Allows development tools to function properly

**Why 'unsafe-eval' in development:**
- ‚úÖ **Vite HMR** - Hot Module Replacement requires eval() for live reloading
- ‚úÖ **React DevTools** - Browser extension uses eval() for component inspection
- ‚úÖ **Tailwind CSS** - Development processing requires dynamic evaluation
- ‚úÖ **Source Maps** - Debugging tools need eval() for accurate line mapping

### üîí Production Mode
- **Location**: `dist/index.html` (generated by `npm run build`)
- **Script Policy**: `script-src 'self'` (strict, no unsafe-eval)
- **Purpose**: Maximum security for deployed applications

**Production CSP automatically:**
- üõ°Ô∏è **Blocks eval()** and all string-to-code evaluation
- üõ°Ô∏è **Enforces HTTPS** for all external resources
- üõ°Ô∏è **Prevents code injection** attacks
- üõ°Ô∏è **Blocks mixed content** (HTTP resources on HTTPS pages)

## Build Process

The build process automatically switches CSP policies:

1. **Development**: `npm run dev`
   ```bash
   # Uses development CSP from index.html
   # Allows unsafe-eval for development tools
   ```

2. **Production Build**: `npm run build`
   ```bash
   vite build                    # Build the application
   node scripts/build-csp.js     # Replace with production CSP
   ```

3. **Development Build**: `npm run build:dev`
   ```bash
   # Build without CSP replacement (for testing)
   ```

## Security Features

### üîê API Security
- **Secure Fetch Wrapper**: All external API calls use `secureFetch()`
- **Domain Whitelist**: Only approved domains allowed for API calls
- **HTTPS Enforcement**: External requests forced to use HTTPS
- **CORS Configuration**: Proper cross-origin request handling

### üõ°Ô∏è Attack Prevention
- **XSS Protection**: CSP prevents script injection attacks
- **Clickjacking**: `frame-ancestors 'none'` blocks iframe embedding
- **MIME Sniffing**: `X-Content-Type-Options: nosniff` header
- **Mixed Content**: Blocked in production, prevents HTTP/HTTPS mixing

### üì° Allowed External Domains
```
‚úÖ api.github.com                          - GitHub API
‚úÖ raw.githubusercontent.com               - GitHub raw files
‚úÖ leetcode-stats-api.herokuapp.com        - LeetCode stats
‚úÖ alfa-leetcode-api.onrender.com          - LeetCode alternative API
‚úÖ leetcode-api-faisalshohag.vercel.app    - LeetCode backup API
‚úÖ fonts.googleapis.com                    - Google Fonts CSS
‚úÖ fonts.gstatic.com                       - Google Fonts files
```

## Deployment Headers

### Netlify/Vercel
The `public/_headers` file contains production security headers:
```
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

### Custom Server
For custom deployments, ensure these headers are set:
- Content Security Policy (from build process)
- Security headers (X-Frame-Options, etc.)
- HTTPS redirection
- HSTS headers for production

## Troubleshooting

### CSP Violations During Development
If you see CSP violations during development:
1. Check that `index.html` contains `'unsafe-eval'` in script-src
2. Restart the development server (`npm run dev`)
3. Clear browser cache and hard refresh (Ctrl+Shift+R)

### New External API
To add a new external API:
1. Add domain to `secureFetch` whitelist in `src/utils/security.js`
2. Add domain to CSP in `index.html`
3. Add domain to production CSP in `scripts/build-csp.js`

### Production CSP Issues
If the production site has CSP violations:
1. Check that `npm run build` was used (not `npm run build:dev`)
2. Verify `dist/index.html` has the production CSP policy
3. Check browser console for specific violation details

## Security Audit

Run security checks:
```bash
npm run security:check    # Verify CSP configuration
npm run build            # Test production build process
```

## Best Practices Implemented

‚úÖ **Least Privilege**: Only necessary permissions granted
‚úÖ **Defense in Depth**: Multiple security layers
‚úÖ **Environment Separation**: Different policies for dev/prod
‚úÖ **Automated Security**: CSP updated automatically during builds
‚úÖ **Regular Updates**: Dependency management for security patches
‚úÖ **Input Validation**: Sanitization utilities for user input
‚úÖ **Secure Communications**: HTTPS enforcement and secure headers
